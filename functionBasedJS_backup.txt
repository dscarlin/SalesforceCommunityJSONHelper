// var pendingDelay,lastLocationChange;

// function locationChange(e){
//     lastLocationChange = new Date().getTime();
//     clearTimeout(pendingDelay); pendingDelay = null;
//     delayedStart(2000);
// }
// function delayedStart(delay, count=0){
//     const time = new Date().getTime();
//     if(!setOpenOption() && count < 5 || time - lastLocationChange < 5000){
//         count++
//         pendingDelay = setTimeout(() => delayedStart(delay, count), delay);
//     }

// }
// // delayedStart(5000)

// function toggleOpacity(e){
//     if(e.target.dataset.bright === 'true'){
//         e.target.style.opacity = .6;
//         e.target.dataset.bright = 'false';
//         e.target.innerHTML = '{}'
//     } else {
//         e.target.style.opacity = 1;
//         e.target.dataset.bright = 'true';
//         e.target.innerHTML = '{...}'

//     }
// }
// function addButton(){
//   const button = document.createElement('button');
//   button.onmouseenter = toggleOpacity;
//   button.onmouseleave = toggleOpacity;
//   button.setAttribute('id','jsonWindowOpener')
//   button.setAttribute('style','position: fixed; right:0; top: 30%;z-index: 1000; font-weight: 1000;border: blue solid 1px;border-radius: 0.3rem 0 0 0.3rem;background: #35a4da; opacity: .6; padding-bottom: 4px;')
//   button.innerHTML = '{}'
//   document.getElementsByTagName('body')[0].append(button);
//   button.addEventListener('click', addWindow);
 
// }
// function removeWindow(){
//   document.getElementById("jsonDataViewer").remove();
//   window.textElement = "";
//   addButton();
// }
// function setOpenOption(){
//   const omniScripts =  [...document.querySelectorAll('[data-data-rendering-service-uid]')].filter(i => i.jsonDataStr)
//   const numberOfOmniScripts = omniScripts.length;
//   if(!omniScripts.length || numberOfOmniScripts > 1){
//     buttonExists() && removeButton();
//     return false;
//   }
//   !buttonExists() && !windowExists() && addButton();
//   return true;
// }
// function addWindow(e){
  

//   window.displayElement = document.createElement('div');
//   window.textElement = document.createElement('textarea');
  
//   var header = document.createElement('div');
//   var copyButton = document.createElement('a');
//   var toastMessage = document.createElement('span');
//   var spacer = document.createElement('span');
//   var deleteButton = document.createElement('a');
  
//   spacer.innerHTML = ' ';
//   toastMessage.setAttribute('id','toastMessage')
  
//   deleteButton.addEventListener('click', removeWindow)
//   deleteButton.setAttribute('style',  'width: fit-content; color: #35a4da')
//   deleteButton.innerHTML = 'X'
  
//   copyButton.setAttribute('onclick', 'navigator.clipboard.writeText(document.getElementById("jsonData").innerHTML);document.getElementById("jsonData").style.backgroundColor = "#acd3e6";setTimeout(()=> document.getElementById("jsonData").style.backgroundColor = "unset", 200)')
//   copyButton.setAttribute('style', 'width: fit-content; color: #35a4da')
//   copyButton.innerHTML = 'Copy'
  
//   header.setAttribute('style','width: 100%; height: 2rem; cursor: move; display: flex; justify-content: space-between;');
//   header.setAttribute('id','header');
  
//   window.textElement.setAttribute('id','jsonData');
//   window.displayElement.setAttribute('id','jsonDataViewer');
//   window.textElement.setAttribute('disabled','');
  
//   header.append(copyButton)
//   header.append(toastMessage)
//   header.append(spacer)
  
//     header.append(deleteButton)
  
  
//   window.displayElement.append(header)
//   window.displayElement.append(window.textElement)
//   window.textElement.setAttribute('style','  max-width: 100%; overflow: scroll;')
//   window.displayElement.setAttribute('style',' display: overflow: scroll;z-index: 1000;background: whitesmoke;padding: 1em; border-style: solid; border-width: 1px;border-color: #35a4da; border-radius: 0.5em; position: absolute; top: 25%; left: 75%')
//   window.dataElement = ()=> [...document.querySelectorAll('[data-data-rendering-service-uid]')].filter(i => i.jsonDataStr)[0]
  
//   var parent = window.dataElement().parentElement;
//   parent.append(window.displayElement);
//   window.textElement.innerHTML = JSON.stringify(JSON.parse(window.dataElement().jsonDataStr), null, 2);
//   var interval;
//   interval = setInterval(()=> {if(window.textElement){document.getElementById('jsonData').innerHTML = JSON.stringify(JSON.parse(window.dataElement().jsonDataStr), null, 2)} else{ clearInterval(interval)}} ,3000)
//   dragElement(document.getElementById("jsonDataViewer"));
//   removeButton();
// }  
// function removeButton(){
//     document.getElementById("jsonWindowOpener").remove()

// }
// function buttonExists(){
//     return !!document.getElementById("jsonWindowOpener");
// }
// function windowExists(){
//     return !!document.getElementById("jsonDataViewer");
// }

// function dragElement(elmnt) {
//   var pos1 = 0, pos2 = 0, pos3 = 0, pos4 = 0;
//   if (document.getElementById("header")) {
//     // if present, the header is where you move the DIV from:
//     document.getElementById("header").onmousedown = dragMouseDown;
//   } else {
//     // otherwise, move the DIV from anywhere inside the DIV:
//     elmnt.onmousedown = dragMouseDown;
//   }

//   function dragMouseDown(e) {
//     e = e || window.event;
//     e.preventDefault();
//     // get the mouse cursor position at startup:
//     pos3 = e.clientX;
//     pos4 = e.clientY;
//     document.onmouseup = closeDragElement;
//     // call a function whenever the cursor moves:
//     document.onmousemove = elementDrag;
//   }

//   function elementDrag(e) {
//     e = e || window.event;
//     e.preventDefault();
//     // calculate the new cursor position:
//     pos1 = pos3 - e.clientX;
//     pos2 = pos4 - e.clientY;
//     pos3 = e.clientX;
//     pos4 = e.clientY;
//     // set the element's new position:
//     elmnt.style.top = (elmnt.offsetTop - pos2) + "px";
//     elmnt.style.left = (elmnt.offsetLeft - pos1) + "px";
//   }

//   function closeDragElement() {
//     // stop moving when mouse button is released:
//     document.onmouseup = null;
//     document.onmousemove = null;
//   }
// }
// history.pushState = (f => function pushState() {
//     var ret = f.apply(this, arguments);
//     window.dispatchEvent(new Event('pushstate'));
//     window.dispatchEvent(new Event('locationchange'));
//     return ret;
// })(history.pushState);

// history.replaceState = (f => function replaceState() {
//     var ret = f.apply(this, arguments);
//     window.dispatchEvent(new Event('replacestate'));
//     window.dispatchEvent(new Event('locationchange'));
//     return ret;
// })(history.replaceState);

// window.addEventListener('popstate', () => {
//     window.dispatchEvent(new Event('locationchange'));
// });

// window.addEventListener('locationchange', locationChange );
